<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Navetra™ Margin-at-Risk Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#050815" />

  <!-- App / iOS icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

  <style>
    :root {
      --pw-primary: #8c1d8c;
      --pw-primary-bright: #bf29ec;
      --pw-secondary: #e3655b;
      --pw-tertiary: #ffbf46;
      --pw-highlight: #48a9a6;
      --pw-bg: #050815;
      --pw-surface: #0b1020;
      --pw-surface-soft: #111827;
      --pw-border: #262b3f;
      --pw-text-main: #f9fafb;
      --pw-text-soft: #a1a5bb;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--pw-text-main);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .app {
      width: 100%;
      max-width: 520px;
      margin: 12px;
      border-radius: 24px;
      padding: 18px 16px 20px;
      background: linear-gradient(145deg, #020617, #050816);
      border: 1px solid rgba(148, 163, 184, 0.22);
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    @media (min-width: 640px) {
      .app {
        padding: 22px 22px 24px;
        margin: 22px;
      }
    }

    .app-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 14px;
    }

    .brand-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #f4f4ff;
    }

    .brand-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, var(--pw-primary-bright), var(--pw-primary));
      box-shadow: 0 0 12px rgba(191, 41, 236, 0.55);
    }

    .app-subtitle {
      font-size: 0.8rem;
      color: var(--pw-text-soft);
    }

    .app-title {
      font-size: 1.3rem;
      font-weight: 650;
      margin-top: 6px;
    }

    .section {
      margin-top: 10px;
    }

    .step-label {
      text-transform: uppercase;
      font-size: 0.68rem;
      letter-spacing: 0.16em;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .helper-text {
      font-size: 0.75rem;
      color: var(--pw-text-soft);
      margin-bottom: 6px;
    }

    /* Domain “page” */

    .domain-shell {
      border-radius: 20px;
      border: 1px solid var(--pw-border);
      background: radial-gradient(circle at top left, rgba(140, 29, 140, 0.25), var(--pw-surface));
      padding: 12px 12px 10px;
    }

    .domain-tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.65rem;
      background: rgba(72, 169, 166, 0.18);
      color: #b7f3ee;
      margin-bottom: 4px;
    }

    .domain-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .domain-desc {
      font-size: 0.78rem;
      color: var(--pw-text-soft);
      margin-bottom: 8px;
    }

    .domain-progress {
      font-size: 0.72rem;
      color: var(--pw-text-soft);
      margin-bottom: 6px;
    }

    .domain-questions {
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 9px 6px;
    }

    .question {
      margin-bottom: 6px;
      font-size: 0.76rem;
    }

    .question:last-child {
      margin-bottom: 2px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 3px;
    }

    .options label {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 3px 8px;
      font-size: 0.7rem;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      cursor: pointer;
      color: #e5e7eb;
    }

    .options input {
      accent-color: var(--pw-primary-bright);
      cursor: pointer;
    }

    .nav-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 10px;
    }

    button.primary {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 9px 12px;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--pw-primary-bright), var(--pw-highlight));
      color: #020617;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.6);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    button.primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.04);
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.75);
    }

    button.secondary {
      min-width: 82px;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.78rem;
      border: 1px solid var(--pw-border);
      background: transparent;
      color: var(--pw-text-soft);
      cursor: pointer;
    }

    button.secondary:disabled {
      opacity: 0.4;
      cursor: default;
    }

    /* Result */

    .result {
      display: none;
      margin-top: 14px;
      border-radius: 18px;
      padding: 9px 10px 10px;
      background: radial-gradient(circle at top right, rgba(72, 169, 166, 0.24), var(--pw-surface-soft));
      font-size: 0.8rem;
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid transparent;
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }

    .risk-green { background: rgba(72, 169, 166, 0.18); border-color: #48a9a6; }
    .risk-green .dot { background: #48a9a6; }

    .risk-yellow { background: rgba(255, 191, 70, 0.2); border-color: #ffbf46; }
    .risk-yellow .dot { background: #ffbf46; }

    .risk-red { background: rgba(227, 101, 91, 0.22); border-color: #e3655b; }
    .risk-red .dot { background: #e3655b; }

    .risk-black { background: rgba(15, 23, 42, 0.98); border-color: #000; }
    .risk-black .dot { background: #000; }

    .result-text {
      margin-top: 6px;
      color: var(--pw-text-main);
    }

    .result-note {
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--pw-text-soft);
    }

    /* Lead form */

    .lead-form {
      display: none;
      margin-top: 12px;
      padding: 10px 10px 9px;
      border-radius: 16px;
      border: 1px solid var(--pw-border);
      background: rgba(10, 15, 30, 0.96);
      font-size: 0.78rem;
    }

    .lead-title {
      font-size: 0.78rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .field-label {
      font-size: 0.72rem;
      color: var(--pw-text-soft);
      margin-top: 6px;
      margin-bottom: 2px;
    }

    .lead-form input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: var(--pw-text-main);
      padding: 6px 8px;
      font-size: 0.78rem;
    }

    .lead-form input::placeholder {
      color: #6b7280;
    }

    .lead-submit {
      width: 100%;
      margin-top: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--pw-secondary);
      color: #020617;
      font-weight: 600;
      font-size: 0.8rem;
    }

    .lead-note {
      margin-top: 6px;
      font-size: 0.7rem;
      color: var(--pw-text-soft);
    }

    .lead-thankyou {
      margin-top: 6px;
      font-size: 0.72rem;
      color: #bbf7d0;
      display: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand-row">
        <div class="brand-dot"></div>
        <span>PURPLE WINS · NAVETRA™</span>
      </div>
      <div class="app-subtitle">
        Executive scan for people-side margin risk. ~2–3 minutes across all domains.
      </div>
      <h1 class="app-title">How much margin are you leaking?</h1>
    </header>

    <!-- DOMAIN “PAGE” -->
    <section class="section" id="domainSection">
      <div class="step-label" id="stepLabel">Step 1 · Domain 1 of 5</div>
      <p class="helper-text" id="helperText">
        Answer all 3 questions for this domain. You’ll move through each domain in sequence and see your overall risk band at the end.
      </p>

      <div class="domain-shell">
        <div class="domain-tag" id="domainTag"></div>
        <div class="domain-title" id="domainTitle"></div>
        <div class="domain-desc" id="domainDesc"></div>
        <div class="domain-progress" id="domainProgress"></div>

        <div class="domain-questions" id="questionsContainer"></div>
      </div>

      <div class="nav-row">
        <button id="backBtn" class="secondary">Back</button>
        <button id="nextBtn" class="primary">Next domain</button>
      </div>
    </section>

    <!-- RESULT -->
    <section class="section">
      <div id="result" class="result">
        <div class="result-title">Overall Margin-at-Risk Snapshot</div>
        <div id="riskBadge" class="badge">
          <div class="dot"></div>
          <span id="riskLabel"></span>
        </div>
        <div id="resultText" class="result-text"></div>
        <div class="result-note">
          This view combines all domains to show your people-side margin exposure on a Green · Yellow · Red · Black (severe) scale.
        </div>
      </div>
    </section>

    <!-- LEAD FORM -->
    <section class="section">
      <div id="leadForm" class="lead-form">
        <div class="lead-title">Step 3 · Request a Navetra™ deepdive into how much margins might be trapped in this risk</div>

        <div class="field-label">Organization (optional)</div>
        <input id="orgInput" type="text" placeholder="e.g., plant / business unit name" />

        <div class="field-label">Association (optional)</div>
        <input id="associationInput" type="text" placeholder="e.g., NIA, EFC, Markham BoT" />

        <div class="field-label">Email address</div>
        <input id="emailInput" type="email" placeholder="you@company.com" autocomplete="email" />

        <button id="submitLeadBtn" type="button" class="lead-submit">
          Send summary to Navetra™ team
        </button>

        <div class="lead-note">
          This snapshot is complimentary. A summary of this mini diagnostic can be sent onward to our secure mailbox if you would like to quantify this risk for your organization and create a practical list of implementation actions to fix the problems.
          Ongoing analysis, deeper diagnostics, and Navetra™ platform access are available as paid services, should you choose to continue.
        </div>
        <div id="leadThankyou" class="lead-thankyou">
          Thank you — your details are noted. A Navetra™ summary will be reviewed and queued for follow-up.
        </div>
      </div>
    </section>
  </div>

  <script>
    // --- Domain definitions (5 domains, 3 questions each) ---
    const domains = [
      {
        id: "hiring",
        tag: "People capacity",
        title: "Hiring Delays",
        desc: "Critical roles sitting open; slow decisions on offers.",
        questions: [
          "Do key roles often stay open longer than 60 days?",
          "Have you delayed production, projects, or service because a role was not filled?",
          "Do hiring decisions frequently get stuck between HR and operations?"
        ]
      },
      {
        id: "knowledge",
        tag: "Know-how risk",
        title: "Knowledge Walking Out",
        desc: "Reliance on a few veterans for critical process knowledge.",
        questions: [
          "Would losing 1–2 experienced people significantly disrupt operations?",
          "Is critical know-how more in people’s heads than in documented systems?",
          "Are retirements or unplanned exits a material operational risk?"
        ]
      },
      {
        id: "leaders",
        tag: "Decision drag",
        title: "Misaligned Leaders",
        desc: "Different leaders giving different answers to the same question.",
        questions: [
          "Do leaders sometimes send mixed or competing signals on priorities?",
          "Do cross-functional decisions bounce around before someone clearly owns them?",
          "Do teams say, “it depends which leader you ask”?"
        ]
      },
      {
        id: "training",
        tag: "ROI drag",
        title: "Training That Doesn’t Stick",
        desc: "Time and budget on training without visible behaviour change.",
        questions: [
          "Do you invest in training where on-floor impact is hard to see?",
          "Is it difficult to tie training back to throughput, quality, or financial outcomes?",
          "Do people revert to old habits within weeks of a training program?"
        ]
      },
      {
        id: "bottlenecks",
        tag: "Flow friction",
        title: "Cross-Team Bottlenecks",
        desc: "Work stalling between departments or shifts.",
        questions: [
          "Do jobs or orders often wait on another department before moving forward?",
          "Do customer issues ever stall because internal handoffs are not clear?",
          "Do you see rework caused by unclear ownership across teams?"
        ]
      }
    ];

    // --- State ---
    let currentDomainIndex = 0;
    const answers = domains.map(d => Array(d.questions.length).fill(null)); // store yes/sometimes/no

    // --- DOM refs ---
    const stepLabel = document.getElementById("stepLabel");
    const helperText = document.getElementById("helperText");
    const domainTag = document.getElementById("domainTag");
    const domainTitle = document.getElementById("domainTitle");
    const domainDesc = document.getElementById("domainDesc");
    const domainProgress = document.getElementById("domainProgress");
    const questionsContainer = document.getElementById("questionsContainer");
    const backBtn = document.getElementById("backBtn");
    const nextBtn = document.getElementById("nextBtn");

    const resultEl = document.getElementById("result");
    const riskBadge = document.getElementById("riskBadge");
    const riskLabel = document.getElementById("riskLabel");
    const resultText = document.getElementById("resultText");

    const leadForm = document.getElementById("leadForm");
    const orgInput = document.getElementById("orgInput");
    const associationInput = document.getElementById("associationInput");
    const emailInput = document.getElementById("emailInput");
    const submitLeadBtn = document.getElementById("submitLeadBtn");
    const leadThankyou = document.getElementById("leadThankyou");

    // --- Render the current domain "page" ---
    function renderDomain() {
      const d = domains[currentDomainIndex];
      const total = domains.length;
      const domainNumber = currentDomainIndex + 1;

      stepLabel.textContent = `Step 1 · Domain ${domainNumber} of ${total}`;
      domainTag.textContent = d.tag;
      domainTitle.textContent = d.title;
      domainDesc.textContent = d.desc;
      domainProgress.textContent = `Answer all 3 questions for this domain (${domainNumber}/${total}).`;

      // questions
      questionsContainer.innerHTML = d.questions
        .map((q, i) => `
          <div class="question">
            Q${i + 1}. ${q}
            <div class="options">
              <label><input type="radio" name="q${i}" value="yes" /> Yes</label>
              <label><input type="radio" name="q${i}" value="sometimes" /> Sometimes</label>
              <label><input type="radio" name="q${i}" value="no" /> No</label>
            </div>
          </div>
        `)
        .join("");

      // restore any previously saved answers
      answers[currentDomainIndex].forEach((val, i) => {
        if (!val) return;
        const input = document.querySelector(`input[name="q${i}"][value="${val}"]`);
        if (input) input.checked = true;
      });

      // nav button states
      backBtn.disabled = currentDomainIndex === 0;
      if (currentDomainIndex === total - 1) {
        nextBtn.textContent = "View overall risk band";
      } else {
        nextBtn.textContent = "Next domain";
      }
    }

    // --- Save answers for current domain; return false if incomplete ---
    function captureCurrentAnswers() {
      const qCount = domains[currentDomainIndex].questions.length;
      for (let i = 0; i < qCount; i++) {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (!selected) {
          alert("Please answer all questions for this domain before continuing.");
          return false;
        }
        answers[currentDomainIndex][i] = selected.value;
      }
      return true;
    }

    // --- Compute cumulative risk across all domains ---
    function computeOverallRisk() {
      let totalScore = 0;
      let answeredAll = true;

      answers.forEach(domainAnswers => {
        domainAnswers.forEach(val => {
          if (!val) answeredAll = false;
          if (val === "yes") totalScore += 2;
          else if (val === "sometimes") totalScore += 1;
        });
      });

      if (!answeredAll) {
        alert("Please complete all domains before viewing your overall risk band.");
        return;
      }

      const maxScore = domains.length * 3 * 2; // 5 domains × 3 questions × 2 pts
      const ratio = totalScore / maxScore;

      let bandLabel, cssClass, explanation;

      if (ratio <= 0.25) {
        bandLabel = "Green — Low margin-at-risk";
        cssClass = "risk-green";
        explanation =
          "Based on your responses, people-side margin risk appears contained. You may still have targeted pockets of leakage, but large-scale exposure is unlikely.";
      } else if (ratio <= 0.5) {
        bandLabel = "Yellow — Moderate margin-at-risk";
        cssClass = "risk-yellow";
        explanation =
          "There is meaningful drag across several domains. Addressing a small set of high-impact practices could recover noticeable capacity and margin.";
      } else if (ratio <= 0.75) {
        bandLabel = "Red — High margin-at-risk";
        cssClass = "risk-red";
        explanation =
          "Your responses suggest elevated people-side risk. Without deliberate intervention, margin leakage is likely to persist or grow under pressure.";
      } else {
        bandLabel = "Black — Severe margin-at-risk";
        cssClass = "risk-black";
        explanation =
          "Signals point to severe people-side margin exposure. A structured diagnostic and implementation plan is recommended to stabilise performance and protect cash.";
      }

      riskBadge.className = `badge ${cssClass}`;
      riskLabel.textContent = bandLabel;
      resultText.textContent = explanation;

      resultEl.style.display = "block";
      leadForm.style.display = "block";
      leadThankyou.style.display = "none";

      // scroll to result on mobile
      resultEl.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // --- Event handlers ---
    backBtn.addEventListener("click", () => {
      if (currentDomainIndex === 0) return;
      if (!captureCurrentAnswers()) return;
      currentDomainIndex -= 1;
      renderDomain();
    });

    nextBtn.addEventListener("click", () => {
      if (!captureCurrentAnswers()) return;

      if (currentDomainIndex < domains.length - 1) {
        currentDomainIndex += 1;
        renderDomain();
      } else {
        // last domain → compute overall risk
        computeOverallRisk();
      }
    });

    submitLeadBtn.addEventListener("click", () => {
      const email = emailInput.value.trim();
      if (!email) {
        alert("Please add your email address so we can route your summary.");
        return;
      }

      const payload = {
        email,
        organization: orgInput.value.trim(),
        association: associationInput.value.trim()
      };

      console.log("Navetra lead (placeholder):", payload);
      leadThankyou.style.display = "block";
    });

    // --- Initial render ---
    renderDomain();

    // --- PWA service worker registration (safe if missing) ---
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
