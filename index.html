<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Navetra™ Margin-at-Risk Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#f3f4f6" />

  <!-- iOS home-screen icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

  <style>
    :root {
      --pw-primary: #8c1d8c;
      --pw-primary-soft: #b567c2;
      --pw-accent: #48a9a6;
      --pw-danger: #e3655b;
      --pw-warning: #f59e0b;
      --pw-severe: #111827;
      --pw-bg: #f3f4f6;
      --pw-surface: #ffffff;
      --pw-surface-soft: #f9fafb;
      --pw-border: #d1d5db;
      --pw-text-main: #111827;
      --pw-text-soft: #6b7280;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--pw-bg);
      color: var(--pw-text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 520px;
      margin: 12px;
      border-radius: 18px;
      background: var(--pw-surface);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--pw-border);
      display: flex;
      flex-direction: column;
    }

    @media (min-width: 640px) {
      .app {
        margin: 24px;
        border-radius: 20px;
      }
    }

    .app-inner {
      padding: 16px 16px 18px;
    }

    @media (min-width: 640px) {
      .app-inner {
        padding: 20px 22px 22px;
      }
    }

    .hidden {
      display: none !important;
    }

    /* Header */

    .app-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 16px;
    }

    .brand-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--pw-primary);
    }

    .brand-dot {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f97316, var(--pw-primary));
      box-shadow: 0 0 10px rgba(140, 29, 140, 0.6);
    }

    .app-subtitle {
      font-size: 0.8rem;
      color: var(--pw-text-soft);
    }

    .app-title {
      font-size: 1.3rem;
      font-weight: 650;
      margin-top: 6px;
    }

    .step-label {
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.14em;
      color: var(--pw-text-soft);
      margin-bottom: 6px;
    }

    .helper-text {
      font-size: 0.8rem;
      color: var(--pw-text-soft);
      margin-bottom: 10px;
    }

    /* Wizard view */

    #wizardView {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .progress-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.78rem;
      color: var(--pw-text-soft);
    }

    .progress-bar {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      margin-left: 8px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--pw-primary-soft), var(--pw-accent));
      transition: width 0.2s ease-out;
    }

    .domain-card {
      border-radius: 14px;
      border: 1px solid var(--pw-border);
      background: var(--pw-surface-soft);
      padding: 12px 10px 10px;
    }

    .domain-tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.68rem;
      background: rgba(140, 29, 140, 0.06);
      color: var(--pw-primary);
      margin-bottom: 4px;
    }

    .domain-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .domain-desc {
      font-size: 0.8rem;
      color: var(--pw-text-soft);
      margin-top: 2px;
    }

    .questions-block {
      margin-top: 8px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      padding: 8px 9px;
    }

    .question {
      margin-bottom: 8px;
      font-size: 0.8rem;
    }

    .question:last-child {
      margin-bottom: 2px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .options label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 9px;
      font-size: 0.78rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      cursor: pointer;
      color: var(--pw-text-main);
    }

    .options input {
      accent-color: var(--pw-primary);
      cursor: pointer;
    }

    .nav-row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    button {
      font-family: inherit;
    }

    .btn-primary {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 9px 12px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--pw-primary), var(--pw-accent));
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(140, 29, 140, 0.18);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 12px 24px rgba(140, 29, 140, 0.25);
    }

    .btn-secondary {
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.8rem;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      color: var(--pw-text-soft);
      cursor: pointer;
      min-width: 80px;
    }

    .btn-secondary:disabled {
      opacity: 0.4;
      cursor: default;
    }

    /* Result view */

    #resultView {
      display: none;
      flex-direction: column;
      gap: 12px;
    }

    .result-card {
      border-radius: 16px;
      border: 1px solid var(--pw-border);
      background: #ffffff;
      padding: 14px 12px 12px;
    }

    .result-title {
      font-size: 1rem;
      font-weight: 650;
      margin-bottom: 6px;
    }

    .band-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid transparent;
      margin-top: 4px;
    }

    .band-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .band-green {
      background: #ecfdf5;
      border-color: #22c55e;
      color: #166534;
    }

    .band-green .band-dot {
      background: #22c55e;
    }

    .band-yellow {
      background: #fffbeb;
      border-color: #fbbf24;
      color: #92400e;
    }

    .band-yellow .band-dot {
      background: #fbbf24;
    }

    .band-red {
      background: #fef2f2;
      border-color: #ef4444;
      color: #991b1b;
    }

    .band-red .band-dot {
      background: #ef4444;
    }

    .band-black {
      background: #111827;
      border-color: #000000;
      color: #f9fafb;
    }

    .band-black .band-dot {
      background: #000000;
    }

    .result-text {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--pw-text-main);
    }

    .result-note {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--pw-text-soft);
    }

    .result-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    /* Lead form */

    .lead-form {
      border-radius: 16px;
      border: 1px solid var(--pw-border);
      background: var(--pw-surface-soft);
      padding: 12px;
      font-size: 0.8rem;
    }

    .lead-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .field-label {
      margin-top: 6px;
      margin-bottom: 2px;
      font-size: 0.78rem;
      color: var(--pw-text-soft);
    }

    .lead-form input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: var(--pw-text-main);
      padding: 7px 9px;
      font-size: 0.8rem;
    }

    .lead-form input::placeholder {
      color: #9ca3af;
    }

    .lead-submit {
      width: 100%;
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--pw-accent);
      color: #ffffff;
      font-weight: 600;
      font-size: 0.82rem;
    }

    .lead-note {
      margin-top: 6px;
      font-size: 0.75rem;
      color: var(--pw-text-soft);
    }

    .lead-thankyou {
      margin-top: 6px;
      font-size: 0.76rem;
      color: #15803d;
      display: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-inner">
      <header class="app-header">
        <div class="brand-row">
          <div class="brand-dot"></div>
          <span>PURPLE WINS · NAVETRA™</span>
        </div>
        <div class="app-subtitle">
          Executive scan for people-side margin risk. ~2–3 minutes across all domains.
        </div>
        <h1 class="app-title">How much margin are you leaking?</h1>
      </header>

      <!-- Wizard (one domain per "page") -->
      <main id="wizardView">
        <div class="step-label">Step 1 · Scan each risk domain</div>
        <p class="helper-text">
          You’ll see one domain at a time. Please answer all 3 questions in each domain. At the end, we’ll show your overall Green · Yellow · Red · Black risk band.
        </p>

        <div class="progress-row">
          <span id="progressText">Domain 1 of 5</span>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>

        <div id="domainContainer"></div>

        <div class="nav-row">
          <button id="backBtn" class="btn-secondary" type="button">Back</button>
          <button id="nextBtn" class="btn-primary" type="button">Next domain</button>
        </div>
      </main>

      <!-- Result view (full-focus screen) -->
      <main id="resultView" class="hidden">
        <div class="step-label">Step 2 · Overall risk band</div>

        <section class="result-card">
          <div class="result-title">Overall Margin-at-Risk Snapshot</div>
          <div id="bandLabel" class="band-label">
            <div class="band-dot"></div>
            <span id="bandText"></span>
          </div>
          <div id="resultText" class="result-text"></div>
          <div class="result-note">
            This combines all five domains to show your people-side margin exposure on a Green · Yellow · Red · Black (severe) scale.
          </div>

          <div class="result-actions">
            <button id="reviewBtn" class="btn-secondary" type="button">
              Review answers
            </button>
            <button id="restartBtn" class="btn-secondary" type="button">
              Start new scan
            </button>
          </div>
        </section>

        <section class="lead-form" style="margin-top: 10px;">
          <div class="lead-title">Step 3 · Optional — request a Navetra™ snapshot</div>

          <div class="field-label">Organization (optional)</div>
          <input id="orgInput" type="text" placeholder="e.g., Plant / business unit name" />

          <div class="field-label">Association (optional)</div>
          <input id="associationInput" type="text" placeholder="e.g., NIA, EFC, Markham BoT" />

          <div class="field-label">Email address</div>
          <input id="emailInput" type="email" placeholder="you@company.com" autocomplete="email" />

          <button id="submitLeadBtn" type="button" class="lead-submit">
            Send summary to Navetra™ team
          </button>

          <div class="lead-note">
            This snapshot is complimentary. A summary of this mini diagnostic can be sent onward to our secure mailbox if you would like to quantify this risk for your organization and create a practical list of implementation actions to fix the problems.
            Ongoing analysis, deeper diagnostics, and Navetra™ platform access are available as paid services, should you choose to continue.
          </div>

          <div id="leadThankyou" class="lead-thankyou">
            Thank you — your details are noted. A Navetra™ summary will be reviewed and queued for follow-up.
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // --- Domains & questions (unchanged scoring logic) ---
    const domains = [
      {
        id: "hiring",
        tag: "People capacity",
        title: "Hiring Delays",
        desc: "Critical roles sitting open; slow decisions on offers.",
        questions: [
          "Do key roles often stay open longer than 60 days?",
          "Have you delayed production, projects, or service because a role was not filled?",
          "Do hiring decisions frequently get stuck between HR and operations?"
        ]
      },
      {
        id: "knowledge",
        tag: "Know-how risk",
        title: "Knowledge Walking Out",
        desc: "Reliance on a few veterans for critical process knowledge.",
        questions: [
          "Would losing 1–2 experienced people significantly disrupt operations?",
          "Is critical know-how more in people’s heads than in documented systems?",
          "Are retirements or unplanned exits a material operational risk?"
        ]
      },
      {
        id: "leaders",
        tag: "Decision drag",
        title: "Misaligned Leaders",
        desc: "Different leaders giving different answers to the same question.",
        questions: [
          "Do leaders sometimes send mixed or competing signals on priorities?",
          "Do cross-functional decisions bounce around before someone clearly owns them?",
          "Do teams say, “it depends which leader you ask”?"
        ]
      },
      {
        id: "training",
        tag: "ROI drag",
        title: "Training That Doesn’t Stick",
        desc: "Time and budget on training without visible behaviour change.",
        questions: [
          "Do you invest in training where on-floor impact is hard to see?",
          "Is it difficult to tie training back to throughput, quality, or financial outcomes?",
          "Do people revert to old habits within weeks of a training program?"
        ]
      },
      {
        id: "bottlenecks",
        tag: "Flow friction",
        title: "Cross-Team Bottlenecks",
        desc: "Work stalling between departments or shifts.",
        questions: [
          "Do jobs or orders often wait on another department before moving forward?",
          "Do customer issues ever stall because internal handoffs are not clear?",
          "Do you see rework caused by unclear ownership across teams?"
        ]
      }
    ];

    // --- State ---
    let currentDomainIndex = 0;
    const answers = domains.map(() => [null, null, null]); // [domain][question] = 'yes'|'sometimes'|'no'

    // --- DOM references ---
    const wizardView = document.getElementById("wizardView");
    const resultView = document.getElementById("resultView");
    const domainContainer = document.getElementById("domainContainer");
    const progressText = document.getElementById("progressText");
    const progressFill = document.getElementById("progressFill");
    const backBtn = document.getElementById("backBtn");
    const nextBtn = document.getElementById("nextBtn");

    const bandLabel = document.getElementById("bandLabel");
    const bandText = document.getElementById("bandText");
    const resultTextEl = document.getElementById("resultText");
    const reviewBtn = document.getElementById("reviewBtn");
    const restartBtn = document.getElementById("restartBtn");

    const orgInput = document.getElementById("orgInput");
    const associationInput = document.getElementById("associationInput");
    const emailInput = document.getElementById("emailInput");
    const submitLeadBtn = document.getElementById("submitLeadBtn");
    const leadThankyou = document.getElementById("leadThankyou");

    // --- Render current domain page ---
    function renderDomainPage() {
      const total = domains.length;
      const d = domains[currentDomainIndex];

      progressText.textContent = `Domain ${currentDomainIndex + 1} of ${total}`;
      progressFill.style.width = `${((currentDomainIndex + 1) / total) * 100}%`;

      backBtn.disabled = currentDomainIndex === 0;
      nextBtn.textContent = currentDomainIndex === total - 1 ? "View overall risk band" : "Next domain";

      const domainAnswers = answers[currentDomainIndex];

      const questionsHTML = d.questions
        .map((q, i) => {
          const val = domainAnswers[i];
          return `
            <div class="question">
              Q${i + 1}. ${q}
              <div class="options">
                <label>
                  <input type="radio" name="q${i}" value="yes" ${val === "yes" ? "checked" : ""} />
                  Yes
                </label>
                <label>
                  <input type="radio" name="q${i}" value="sometimes" ${val === "sometimes" ? "checked" : ""} />
                  Sometimes
                </label>
                <label>
                  <input type="radio" name="q${i}" value="no" ${val === "no" ? "checked" : ""} />
                  No
                </label>
              </div>
            </div>
          `;
        })
        .join("");

      domainContainer.innerHTML = `
        <article class="domain-card">
          <div class="domain-tag">${d.tag}</div>
          <div class="domain-title">${d.title}</div>
          <div class="domain-desc">${d.desc}</div>
          <div class="questions-block">
            ${questionsHTML}
          </div>
        </article>
      `;

      // Attach listeners to update state on change
      d.questions.forEach((_, i) => {
        document.querySelectorAll(`input[name="q${i}"]`).forEach((inputEl) => {
          inputEl.addEventListener("change", (e) => {
            answers[currentDomainIndex][i] = e.target.value;
          });
        });
      });
    }

    // --- Navigation helpers ---
    function canAdvanceCurrentDomain() {
      return answers[currentDomainIndex].every((val) => val === "yes" || val === "sometimes" || val === "no");
    }

    function handleNext() {
      if (!canAdvanceCurrentDomain()) {
        alert("Please answer all 3 questions in this domain before continuing.");
        return;
      }
      if (currentDomainIndex < domains.length - 1) {
        currentDomainIndex++;
        renderDomainPage();
      } else {
        computeOverallRisk();
      }
    }

    function handleBack() {
      if (currentDomainIndex === 0) return;
      currentDomainIndex--;
      renderDomainPage();
    }

    // --- Risk computation (cumulative across all domains) ---
    function computeOverallRisk() {
      const numDomains = domains.length;
      const questionsPerDomain = 3;
      let totalScore = 0;

      for (let d = 0; d < numDomains; d++) {
        for (let q = 0; q < questionsPerDomain; q++) {
          const val = answers[d][q];
          if (!val) {
            alert("Please complete all domains before viewing your overall risk band.");
            currentDomainIndex = d;
            renderDomainPage();
            return;
          }
          if (val === "yes") totalScore += 2;
          else if (val === "sometimes") totalScore += 1;
        }
      }

      const maxScore = numDomains * questionsPerDomain * 2;
      const ratio = totalScore / maxScore;

      let label, cssClass, explanation;

      if (ratio <= 0.25) {
        label = "Green — Low margin-at-risk";
        cssClass = "band-green";
        explanation =
          "Based on your responses, people-side margin risk appears contained. There may still be targeted pockets of leakage, but large-scale exposure is unlikely.";
      } else if (ratio <= 0.5) {
        label = "Yellow — Moderate margin-at-risk";
        cssClass = "band-yellow";
        explanation =
          "There is meaningful drag across several domains. Addressing a small set of high-impact practices could recover noticeable capacity and margin.";
      } else if (ratio <= 0.75) {
        label = "Red — High margin-at-risk";
        cssClass = "band-red";
        explanation =
          "Your responses suggest elevated people-side risk. Without deliberate intervention, margin leakage is likely to persist or grow under pressure.";
      } else {
        label = "Black — Severe margin-at-risk";
        cssClass = "band-black";
        explanation =
          "Signals point to severe people-side margin exposure. A structured diagnostic and implementation plan is recommended to stabilise performance and protect cash.";
      }

      bandLabel.className = `band-label ${cssClass}`;
      bandText.textContent = label;
      resultTextEl.textContent = explanation;

      wizardView.classList.add("hidden");
      resultView.classList.remove("hidden");
    }

    function restartScan() {
      currentDomainIndex = 0;
      for (let d = 0; d < answers.length; d++) {
        answers[d] = [null, null, null];
      }
      orgInput.value = "";
      associationInput.value = "";
      emailInput.value = "";
      leadThankyou.style.display = "none";
      resultView.classList.add("hidden");
      wizardView.classList.remove("hidden");
      renderDomainPage();
    }

    function reviewAnswers() {
      // Go back to first domain but keep answers
      currentDomainIndex = 0;
      resultView.classList.add("hidden");
      wizardView.classList.remove("hidden");
      renderDomainPage();
    }

    // --- Lead capture (front-end only; hook to Formspree/backend later) ---
    function handleLeadSubmit() {
      const email = emailInput.value.trim();
      if (!email) {
        alert("Please add your email address so we can route your summary.");
        return;
      }

      const payload = {
        email,
        organization: orgInput.value.trim(),
        association: associationInput.value.trim(),
        scores: answers
      };

      // TODO: integrate with Formspree, a backend API, or similar
      console.log("Navetra lead (not yet sent):", payload);

      leadThankyou.style.display = "block";
    }

    // --- Wire up buttons ---
    backBtn.addEventListener("click", handleBack);
    nextBtn.addEventListener("click", handleNext);
    restartBtn.addEventListener("click", restartScan);
    reviewBtn.addEventListener("click", reviewAnswers);
    submitLeadBtn.addEventListener("click", handleLeadSubmit);

    // --- Initial render ---
    renderDomainPage();

    // --- Optional PWA SW registration ---
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .catch(() => {
            // ignore if not present
          });
      });
    }
  </script>
</body>
</html>

