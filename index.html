<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Navetra™ Margin-at-Risk Scan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ffffff" />

  <!-- iOS / icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

  <style>
    :root {
      --pw-primary: #8c1d8c;
      --pw-primary-soft: #c084fc;
      --pw-accent: #48a9a6;
      --pw-danger: #dc2626;
      --pw-bg: #f3f4f6;
      --pw-surface: #ffffff;
      --pw-border: #e5e7eb;
      --pw-text-main: #111827;
      --pw-text-soft: #6b7280;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 40%, #e5e7eb 100%);
      color: var(--pw-text-main);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 540px;
      margin: 12px;
      padding: 16px 14px 18px;
      background: var(--pw-surface);
      border: 1px solid var(--pw-border);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      border-radius: 0; /* squared */
    }

    @media (min-width: 640px) {
      .app {
        margin: 24px;
        padding: 20px 18px 22px;
      }
    }

    .app-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 14px;
    }

    .brand-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--pw-primary);
    }

    .brand-dot {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, var(--pw-primary-soft), var(--pw-primary));
      box-shadow: 0 0 10px rgba(140, 29, 140, 0.45);
    }

    .app-subtitle {
      font-size: 0.8rem;
      color: var(--pw-text-soft);
    }

    .app-title {
      font-size: 1.2rem;
      font-weight: 650;
      margin-top: 4px;
    }

    .step-label {
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.14em;
      color: var(--pw-text-soft);
      margin-bottom: 4px;
    }

    .helper-text {
      font-size: 0.78rem;
      color: var(--pw-text-soft);
      margin-bottom: 10px;
    }

    .section {
      margin-top: 10px;
    }

    /* Domain "page" */

    .domain-card {
      border-radius: 0;
      border: 1px solid var(--pw-border);
      background: #f9fafb;
      padding: 12px 10px 10px;
    }

    .domain-top-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .domain-tag {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 0;
      background: rgba(140, 29, 140, 0.06);
      color: var(--pw-primary);
      font-weight: 500;
    }

    .domain-progress {
      font-size: 0.72rem;
      color: var(--pw-text-soft);
    }

    .domain-title {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .domain-desc {
      font-size: 0.78rem;
      color: var(--pw-text-soft);
      margin-bottom: 8px;
    }

    .question-block {
      margin-bottom: 8px;
      font-size: 0.8rem;
    }

    .question-text {
      margin-bottom: 4px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .options label {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 4px 9px;
      font-size: 0.75rem;
      border-radius: 0;
      border: 1px solid #d1d5db;
      background: #ffffff;
      cursor: pointer;
      color: var(--pw-text-main);
    }

    .options input {
      accent-color: var(--pw-primary);
      cursor: pointer;
    }

    .nav-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 12px;
    }

    button.primary {
      flex: 1;
      border-radius: 0;
      border: none;
      padding: 9px 12px;
      font-size: 0.86rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--pw-primary), var(--pw-accent));
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
    }

    button.primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.25);
    }

    button.secondary {
      border-radius: 0;
      padding: 8px 12px;
      font-size: 0.8rem;
      border: 1px solid var(--pw-border);
      background: #ffffff;
      color: var(--pw-text-soft);
      cursor: pointer;
    }

    button.secondary:disabled {
      opacity: 0.4;
      cursor: default;
    }

    /* Result section */

    #resultSection {
      display: none;
      margin-top: 16px;
    }

    .result-card {
      border-radius: 0;
      padding: 14px 12px 12px;
      background: #ffffff;
      border: 1px solid var(--pw-border);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.18);
    }

    .result-title {
      font-size: 1rem;
      font-weight: 650;
      margin-bottom: 6px;
    }

    .band-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      padding: 4px 10px;
      border-radius: 0;
      font-size: 0.8rem;
      border: 1px solid transparent;
    }

    .band-dot {
      width: 11px;
      height: 11px;
      border-radius: 999px;
    }

    .band-green {
      background: #ecfdf3;
      border-color: #16a34a;
      color: #166534;
    }

    .band-green .band-dot { background: #16a34a; }

    .band-yellow {
      background: #fefce8;
      border-color: #eab308;
      color: #854d0e;
    }

    .band-yellow .band-dot { background: #eab308; }

    .band-red {
      background: #fef2f2;
      border-color: #dc2626;
      color: #991b1b;
    }

    .band-red .band-dot { background: #dc2626; }

    .band-black {
      background: #111827;
      border-color: #000000;
      color: #f9fafb;
    }

    .band-black .band-dot { background: #000000; }

    .result-text {
      margin-top: 10px;
      font-size: 0.86rem;
      color: var(--pw-text-main);
    }

    .result-note {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--pw-text-soft);
    }

    /* Lead form */

    .lead-form {
      margin-top: 14px;
      padding: 12px 12px 10px;
      border-radius: 0;
      border: 1px solid var(--pw-border);
      background: #f9fafb;
      font-size: 0.82rem;
    }

    .lead-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .field-label {
      font-size: 0.78rem;
      color: var(--pw-text-soft);
      margin-top: 8px;
      margin-bottom: 2px;
    }

    .lead-form input {
      width: 100%;
      border-radius: 0;
      border: 1px solid var(--pw-border);
      padding: 7px 9px;
      font-size: 0.82rem;
    }

    .lead-form input::placeholder {
      color: #9ca3af;
    }

    .lead-actions-secondary {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 10px;
    }

    .lead-secondary-btn {
      width: 100%;
      padding: 7px 10px;
      border-radius: 0;
      border: none;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.8rem;
    }

    .btn-whatsapp {
      background: #25d366;
      color: #0b1120;
    }

    .btn-sms {
      background: #111827;
      color: #f9fafb;
    }

    .lead-note {
      margin-top: 8px;
      font-size: 0.76rem;
      color: var(--pw-text-soft);
    }

    .lead-thankyou {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #15803d;
      display: none;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand-row">
        <div class="brand-dot"></div>
        <span>PURPLE WINS · NAVETRA™</span>
      </div>
      <div class="app-subtitle">
        Executive scan for people-side margin risk. ~2–3 minutes across core domains.
      </div>
      <h1 class="app-title">How much margin are you leaking?</h1>
    </header>

    <!-- DOMAIN FLOW SECTION -->
    <section id="domainSection" class="section">
      <div class="step-label">Step 1 · Scan each risk domain</div>
      <p class="helper-text">
        Answer 3 questions for each domain. Once all domains are complete, you’ll see your overall risk band.
      </p>

      <div id="domainCard" class="domain-card">
        <!-- filled by JS -->
      </div>

      <div class="nav-row">
        <button id="backBtn" class="secondary" type="button">Back</button>
        <button id="nextBtn" class="primary" type="button">Next</button>
      </div>
    </section>

    <!-- RESULT + LEAD SECTION -->
    <section id="resultSection" class="section">
      <div class="step-label">Step 2 · Review your overall risk band</div>

      <div class="result-card">
        <div class="result-title">Overall Margin-at-Risk Snapshot</div>
        <div id="bandChip" class="band-chip">
          <div class="band-dot"></div>
          <span id="bandLabel"></span>
        </div>
        <div id="resultText" class="result-text"></div>
        <div class="result-note">
          This is a directional signal. Navetra™ quantifies this exposure in dollars and prioritises where to recover margin.
        </div>
      </div>

      <div class="lead-form">
        <div class="lead-title">Step 3 · Send this snapshot (with your email)</div>

        <div class="field-label">Organization (optional)</div>
        <input id="orgInput" type="text" placeholder="Plant or business unit name" />

        <div class="field-label">Association (optional)</div>
        <input id="associationInput" type="text" placeholder="e.g., NIA, EFC, Markham BoT" />

        <div class="field-label">Your email</div>
        <input id="emailInput" type="email" placeholder="you@company.com" autocomplete="email" />

        <div class="lead-actions-secondary">
          <button id="whatsAppBtn" class="lead-secondary-btn btn-whatsapp" type="button">
            Send via WhatsApp
          </button>
          <button id="smsBtn" class="lead-secondary-btn btn-sms" type="button">
            Send via text message
          </button>
        </div>

        <div class="lead-note">
          Tapping WhatsApp or text will open a message to Navetra™ with your band, organization, and email pre-filled.
          You can edit the message before you send it.
        </div>
        <div id="leadThankyou" class="lead-thankyou">
          Draft created — check your messaging app to send.
        </div>
      </div>
    </section>
  </div>

  <script>
    // ------- DOMAIN DEFINITIONS -------

    const domains = [
      {
        id: "Talent Acquisition",
        tag: "People capacity",
        title: "Hiring Delays",
        desc: "Critical roles sitting open; slow decisions on offers.",
        questions: [
          "Do key roles often stay open longer than 60 days?",
          "Have you delayed production, projects, or service because a role was not filled?",
          "Do hiring decisions frequently get stuck between HR and operations?"
        ]
      },
      {
        id: "Intellectual Property & Know-How",
        tag: "Know-how risk",
        title: "Knowledge Walking Out",
        desc: "Reliance on a few veterans for critical process knowledge.",
        questions: [
          "Would losing 1–2 experienced people significantly disrupt operations?",
          "Is critical know-how more in people’s heads than in documented systems?",
          "Are retirements or unplanned exits a material operational risk?"
        ]
      },
      {
        id: "Leadership",
        tag: "Decision drag",
        title: "Misaligned Leaders",
        desc: "Different leaders giving different answers to the same question.",
        questions: [
          "Do leaders sometimes send mixed or competing signals on priorities?",
          "Do cross-functional decisions bounce around before someone clearly owns them?",
          "Do teams say, “it depends which leader you ask”?"
        ]
      },
      {
        id: "Learning & Improvement",
        tag: "ROI drag",
        title: "Training That Doesn’t Stick",
        desc: "Time and budget on training without visible behaviour change.",
        questions: [
          "Do you invest in training where on-floor impact is hard to see?",
          "Is it difficult to tie training back to throughput, quality, or financial outcomes?",
          "Do people revert to old habits within weeks of a training program?"
        ]
      },
      {
        id: "Functional Bottlenecks",
        tag: "Flow friction",
        title: "Cross-Team Bottlenecks",
        desc: "Work stalling between departments or shifts.",
        questions: [
          "Do jobs or orders often wait on another department before moving forward?",
          "Do customer issues ever stall because internal handoffs are not clear?",
          "Do you see rework caused by unclear ownership across teams?"
        ]
      }
    ];

    // ------- STATE -------

    let currentDomainIndex = 0;
    const answers = domains.map(() => [null, null, null]);
    let lastBandLabel = "";
    let lastBandExplanation = "";

    // ------- DOM HOOKS -------

    const domainSection = document.getElementById("domainSection");
    const domainCard = document.getElementById("domainCard");
    const backBtn = document.getElementById("backBtn");
    const nextBtn = document.getElementById("nextBtn");

    const resultSection = document.getElementById("resultSection");
    const bandChip = document.getElementById("bandChip");
    const bandLabel = document.getElementById("bandLabel");
    const resultText = document.getElementById("resultText");

    const orgInput = document.getElementById("orgInput");
    const associationInput = document.getElementById("associationInput");
    const emailInput = document.getElementById("emailInput");
    const leadThankyou = document.getElementById("leadThankyou");
    const whatsAppBtn = document.getElementById("whatsAppBtn");
    const smsBtn = document.getElementById("smsBtn");

    // ------- RENDER CURRENT DOMAIN "PAGE" -------

    function renderDomain() {
      const d = domains[currentDomainIndex];
      const total = domains.length;
      const idx = currentDomainIndex;

      const questionHtml = d.questions
        .map((q, qIndex) => {
          const name = `q${qIndex}`;
          const saved = answers[idx][qIndex];

          return `
            <div class="question-block">
              <div class="question-text">Q${qIndex + 1}. ${q}</div>
              <div class="options">
                <label>
                  <input type="radio" name="${name}" value="yes" ${saved === "yes" ? "checked" : ""} />
                  Yes
                </label>
                <label>
                  <input type="radio" name="${name}" value="sometimes" ${saved === "sometimes" ? "checked" : ""} />
                  Sometimes
                </label>
                <label>
                  <input type="radio" name="${name}" value="no" ${saved === "no" ? "checked" : ""} />
                  No
                </label>
              </div>
            </div>
          `;
        })
        .join("");

      domainCard.innerHTML = `
        <div class="domain-top-row">
          <div class="domain-tag">${d.tag}</div>
          <div class="domain-progress">Domain ${idx + 1} of ${total}</div>
        </div>
        <div class="domain-title">${d.title}</div>
        <div class="domain-desc">${d.desc}</div>
        ${questionHtml}
      `;

      backBtn.disabled = currentDomainIndex === 0;
      nextBtn.textContent =
        currentDomainIndex === domains.length - 1
          ? "View overall risk band"
          : "Next domain";
    }

    // ------- VALIDATE & SAVE CURRENT DOMAIN ANSWERS -------

    function validateAndSaveCurrentDomain() {
      const idx = currentDomainIndex;
      const currentAnswers = [];

      for (let q = 0; q < 3; q++) {
        const selected = document.querySelector(`input[name="q${q}"]:checked`);
        if (!selected) {
          alert("Please answer all three questions before moving to the next domain.");
          return false;
        }
        currentAnswers.push(selected.value);
      }

      answers[idx] = currentAnswers;
      return true;
    }

    // ------- COMPUTE OVERALL RISK -------

    function computeOverallRisk() {
      let totalScore = 0;
      const maxScore = domains.length * 3 * 2;

      answers.forEach(domainAnswers => {
        domainAnswers.forEach(v => {
          if (v === "yes") totalScore += 2;
          else if (v === "sometimes") totalScore += 1;
        });
      });

      const ratio = totalScore / maxScore;

      let label, cssClass, explanation;
      if (ratio <= 0.25) {
        label = "Green — Low margin-at-risk";
        cssClass = "band-green";
        explanation =
          "Based on your responses, people-side margin risk appears contained. You may still have targeted pockets of leakage, but large-scale exposure is unlikely.";
      } else if (ratio <= 0.5) {
        label = "Yellow — Moderate margin-at-risk";
        cssClass = "band-yellow";
        explanation =
          "There is meaningful drag across several domains. Addressing a focused set of practices could recover noticeable capacity and margin.";
      } else if (ratio <= 0.75) {
        label = "Red — High margin-at-risk";
        cssClass = "band-red";
        explanation =
          "Your responses suggest elevated people-side risk. Without deliberate intervention, margin leakage is likely to persist or grow under pressure.";
      } else {
        label = "Black — Severe margin-at-risk";
        cssClass = "band-black";
        explanation =
          "Signals point to severe people-side margin exposure. A structured diagnostic and implementation plan is recommended to stabilise performance and protect cash.";
      }

      lastBandLabel = label;
      lastBandExplanation = explanation;

      bandChip.className = `band-chip ${cssClass}`;
      bandLabel.textContent = label;
      resultText.textContent = explanation;
    }

    // ------- BUILD SHARE PAYLOAD & TEXT -------

    function buildLeadPayload() {
      return {
        email: emailInput.value.trim(),
        organization: orgInput.value.trim(),
        association: associationInput.value.trim(),
        band: lastBandLabel,
        explanation: lastBandExplanation
      };
    }

    function buildShareText(payload) {
      let msg = "Navetra™ margin-at-risk scan\n";
      if (payload.band) msg += `Band: ${payload.band}\n`;
      if (payload.organization) msg += `Organization: ${payload.organization}\n`;
      if (payload.association) msg += `Association: ${payload.association}\n`;
      if (payload.email) msg += `Email: ${payload.email}\n`;
      msg += "\nPlease review and let’s discuss next steps to quantify this risk in dollars.";
      return msg;
    }

    // ------- NAV HANDLERS -------

    backBtn.addEventListener("click", () => {
      if (currentDomainIndex > 0) {
        currentDomainIndex--;
        renderDomain();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (!validateAndSaveCurrentDomain()) return;

      if (currentDomainIndex < domains.length - 1) {
        currentDomainIndex++;
        renderDomain();
      } else {
        computeOverallRisk();
        domainSection.style.display = "none";
        resultSection.style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    });

    // ------- WHATSAPP + SMS (email only via these channels) -------

    function showThankYou() {
      if (leadThankyou) {
        leadThankyou.style.display = "block";
        setTimeout(() => {
          leadThankyou.style.display = "none";
        }, 4000);
      }
    }

    // WhatsApp: opens chat to +1-226-977-1651 with pre-filled text.
    whatsAppBtn.addEventListener("click", () => {
      const payload = buildLeadPayload();
      const msg = buildShareText(payload);
      const waUrl = "https://wa.me/12269771651?text=" + encodeURIComponent(msg);
      window.open(waUrl, "_blank");
      showThankYou();
    });

    // SMS: opens SMS composer to +1-226-977-1651 (works on phones)
    smsBtn.addEventListener("click", () => {
      const payload = buildLeadPayload();
      const msg = buildShareText(payload);
      const smsUrl = "sms:+12269771651?body=" + encodeURIComponent(msg);
      window.location.href = smsUrl;
      showThankYou();
    });

    // ------- INIT -------

    renderDomain();

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
